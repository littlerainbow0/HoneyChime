<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/src/assets/css/header.css">
    <link rel="stylesheet" href="/src/assets/css/reservation.css">
    <link rel="stylesheet" href="/src/assets/css/top_btn.css">
    <title>預約行程TEST</title>
</head>

<body class="reservation">
    <header class="reservation_hero">
        <div class="header_logo">
            <a href="#">
                <img src="/src/assets/images/icon/LOGO.svg" alt="">
            </a>
            <a href="">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M20 22H4v-2a5 5 0 0 1 5-5h6a5 5 0 0 1 5 5zm-8-9a6 6 0 1 1 0-12a6 6 0 0 1 0 12" />
                </svg>
            </a>
        </div>

        <nav class="header_nav">
            <ul>
                <li><a href="">首頁</a></li>
                <li><a href="">概念</a></li>
                <li><a href="">饗宴</a></li>
                <li><a href="/facilities.html">設施</a></li>
                <li><a href="/trip.html">旅程</a></li>
            </ul>
        </nav>
    </header>
    <!-- 上方訂單需求 -->
    <form action="">
        <div class="form_apply">

            <div>
                <label for="people">旅客人數：</label>
                <select name="" id="people">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>

            <div>
                <label for="departure_date">出發日期：</label>
                <input type="date" name="" id="departure_date">
            </div>

            <div>
                <label for="departure_time">出發時間：</label>
                <select name="" id="departure_time">
                    <option value="14_17" selected>14:00 - 17:00</option>
                    <option value="15_18">15:00 - 18:00</option>
                </select>
            </div>

            <div>
                <label for="route">路線：</label>
                <select name="" id="route">
                    <option value="taipei_taichung">台北 ⭢ 台中</option>
                    <option value="taipei_hualien">台北 ⭢ 花蓮</option>
                    <option value="taichung_tainan">台中 ⭢ 台南</option>
                    <option value="taichung_kaohsiung">台中 ⭢ 高雄</option>
                    <option value="kaohsiung_taichung">高雄 ⭢ 台中</option>
                    <option value="kaohsiung_hualien">高雄 ⭢ 花蓮</option>
                </select>
            </div>
        </div>

        <div class="form_seat">
            <div class="seat_title">
                <div>
                    <label for="car_type">車廂類型：</label>
                    <select name="" id="car_type" onchange="updateCarImage()">
                        <option value="f">景觀車廂Ｆ - 雙人座</option>
                        <option value="e">景觀車廂Ｅ - 四人座</option>
                        <option value="d">景觀車廂Ｄ - 雙人包廂</option>
                        <option value="a">豪華景觀車廂Ａ - VIP 四人席</option>
                    </select>
                </div>
                <!-- <div>
                    <label for="seat">座位：</label>
                    <select name="" id="seat">
                        <option value="0">請選擇座位</option>
                        <option value="f1">F1</option>
                        <option value="f2">F2</option>
                        <option value="f3">F3</option>
                        <option value="f4">F4</option>
                        <option value="f5">F5</option>
                        <option value="f6">F6</option>
                        <option value="f7">F7</option>
                        <option value="f8">F8</option>
                    </select>
                </div> -->
            </div>
            <!-- <div class="seat_img"> -->
            <!-- <p>車廂示意圖</p> -->
            <object id="car_image" data="/src/assets/images/plan/F.svg">
            </object>
            <!-- </div> -->
        </div>

    </form>
    <!-- 上方應單需求結束 -->

    <!-- 中間訂單內容 -->
    <div class="order_list">
        <!-- 左側訂單內容 -->
        <div class="trip_detail">

            <div>
                <h6>
                    行程
                </h6>
                <div>
                    <img src="/src/assets/images/train_exterior/tripInfo_train01.png" alt="">
                    <p>台北⭢台中</p>
                </div>
            </div>

            <div>
                <h6>
                    選擇餐點
                </h6>
                <div>
                    <div>
                        <img src="/src/assets/images/dessert/trip_Jp.png" alt="">
                        <label for="dessert_jpA_qty">
                            套餐名稱：舒芙蕾套餐
                            <br>
                            套餐內容：舒芙蕾, 抹茶
                        </label>
                        <select name="" id="dessert_jpA_qty">
                            <option value="0" selected>0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>

                    <div>
                        <img src="/src/assets/images/dessert/tripInfo_Jp02.png" alt="">
                        <label for="dessert_jpB_qty">
                            套餐名稱：日式和菓子
                            <br>
                            套餐內容：日式和菓子, 煎茶
                        </label>
                        <select name="" id="dessert_jpB_qty">
                            <option value="0" selected>0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <!-- 左側訂單內容結束 -->

        <!-- 右側訂單明細 -->
        <div class="order_detail">
            <p>您的預約 - 蜂鳴號</p>
            <p>
                <span>路線</span>
                <span>台北 ⭢ 台中</span>
            </p>
            <p>
                <span>出發時間</span>
                <span>Fri,20 Sep 2024 09:00</span>
            </p>
            <p>
                <span>抵達時間</span>
                <span>Fri,20 Sep 2024 13:00</span>
            </p>
            <p>
                <span>乘客人數</span>
                <span>2 人
                </span>
            </p>
            <p>
                <span>車廂</span>
                <span>景觀車廂Ｆ - 雙人座</span>
            </p>
            <p>
                <span>座位</span>
                <span>F1</span>
            </p>
            <p>
                <span>餐點</span>
                <span> 日式舒芙蕾套餐*1, <br>
                    日式菓子套餐*1</span>
            </p>
            <p>
                <span>金額</span>
                <span>$4000</span>
            </p>
        </div>
        <!-- 右側訂單明細結束 -->

    </div>
    <!-- 訂單資訊結束 -->

    <!-- 訂位人資料 -->
    <div class="user_info">
        <h6>訂位人資料</h6>
        <label for="lastName">姓名</label>
        <br>
        <input type="text" id="Name" placeholder="請輸入姓名" minlength="2" required>
        <span class="error"></span>

        <br>
        <label for="phone">手機號碼</label>
        <br>
        <input type="tel" id="phone" pattern="09[0-9]{10}" placeholder="請輸入手機號碼" required>
        <span class="error"></span>
        <br>
        <label for="email">電子郵件</label>
        <br>
        <input type="email" id="email" placeholder="請輸入電子郵件" required>
        <span class="error"></span>

        <br>
        <label for="creditCard">信用卡號</label>
        <br>
        <input type="text" id="creditCard" pattern="[0-9]{4}-[0-9]{4}-[0-9]{4}-[0-9]{4}"
            placeholder="xxxx-xxxx-xxxx-xxxx" required>
        <span class="error"></span>

        <button type="submit" onclick="userInfoCheck()" id="complete">下一步</button>
    </div>
    <!-- 訂位人資料結束 -->

    <a href="#" class="top">
        Λ
        <br>
        Top
    </a>
    <script>

        // -------------------------------------------

        updateCarImage();
        function updateCarImage() {
            const svgTrain = document.getElementById("car_image");

            data =
                [
                    { seatID: 1, seatName: "F1", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 2, seatName: "F2", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 3, seatName: "F3", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 4, seatName: "F4", isAvailable: 0, price: 2000, count: 1 },
                    { seatID: 5, seatName: "F5", isAvailable: 0, price: 2000, count: 2 },
                    { seatID: 6, seatName: "F6", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 7, seatName: "F7", isAvailable: 0, price: 2000, count: 2 },
                    { seatID: 8, seatName: "F8", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 9, seatName: "E2", isAvailable: 0, price: 2000, count: 3 },
                    { seatID: 10, seatName: "E3", isAvailable: 1, price: 2000, count: 0 },
                    { seatID: 11, seatName: "E4", isAvailable: 1, price: 2000, count: 0 },


                ]; //初始資料 ==> 這邊之後要用API抓
                let table = svg.contentDocument.querySelectorAll(`[class=seatF${i + 1}]`);

                
        }

// =====
        //  const svgTrain = document.getElementById("car_image");

        //         data =
        //             [
        //                 { seatID: 1, seatName: "F1", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 2, seatName: "F2", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 3, seatName: "F3", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 4, seatName: "F4", isAvailable: 0, price: 2000, count: 1 },
        //                 { seatID: 5, seatName: "F5", isAvailable: 0, price: 2000, count: 2 },
        //                 { seatID: 6, seatName: "F6", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 7, seatName: "F7", isAvailable: 0, price: 2000, count: 2 },
        //                 { seatID: 8, seatName: "F8", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 9, seatName: "E2", isAvailable: 0, price: 2000, count: 3 },
        //                 { seatID: 10, seatName: "E3", isAvailable: 1, price: 2000, count: 0 },
        //                 { seatID: 11, seatName: "E4", isAvailable: 1, price: 2000, count: 0 },


        //             ]; //初始資料 ==> 這邊之後要用API抓

        //         myFun(svgTrain);




        //         function myFun(svg) {
        //             svg.addEventListener("load", function () {
        //                 let nowTable = "";

        //                 refreshUI(svg);
        //                 for (let i = 0; i < data.length; i++) { //全部的桌子
        //                     if (data[i].isAvailable) { //根據data的isAvailable 去變色
        //                         let table = svg.contentDocument.querySelectorAll(`[class=seatF${i + 1}]`); //找到各個桌子
        //                         let tableE = svg.contentDocument.querySelectorAll(`[class=seatE${i + 1}]`); //找到各個桌子
        //                         table.forEach((seat) => { //找到對應的桌子 裡面有有兩張椅子 迴圈找裡面兩張椅子
        //                             seat.addEventListener("click", function () {//椅子點擊事件
        //                                 nowTable = seat.getAttribute("class");
        //                                 if (seat.getAttribute('isClicked') == "1") {
        //                                     seat.setAttribute("fill", "#F0F0F0");
        //                                     seat.setAttribute("isClicked", '0');
        //                                     refreshUI(svg, "0.5", nowTable); //將除了選擇的桌子透明度設為0.5
        //                                     setOpacity(svg, nowTable);  //將同桌的位子透明度設為 0.5
        //                                 }
        //                                 else {
        //                                     seat.setAttribute("isClicked", "1");
        //                                     refreshUI(svg, "0.5", nowTable); //將除了選擇的桌子透明度設為0.5
        //                                     setOpacity(svg, nowTable);  //將同桌的位子透明度設為1
        //                                 }
        //                             })
        //                         });
        //                     }
        //                 }

        //                 document.getElementById("complete").addEventListener("click", function () {
        //                     setData(svg);
        //                 })
        //             })
        //         }


        //         function setData(svg) {
        //             for (let i = 0; i < data.length; i++) {
        //                 let table = svg.contentDocument.querySelectorAll(`[class=seatF${i + 1}]`); //找到各個桌子
        //                 table.forEach((seat) => {
        //                     if (seat.getAttribute("isClicked") == "1") {
        //                         data[i].isAvailable = 0;
        //                         data[i].count++;
        //                     }
        //                 })
        //             }
        //             console.log(data); // 按ok之後傳出去的資料, post...
        //         }

        //         function setOpacity(svg, className) {
        //             let temp = svg.contentDocument.getElementsByClassName(`${className}`);
        //             let checked = 0;
        //             console.log(className);

        //             for (let i = 0; i < temp.length; i++) {
        //                 if (temp[i].getAttribute("isClicked") == 1)
        //                     checked++;
        //             }
        //             for (let i = 0; i < temp.length; i++) {
        //                 if (checked > 0)
        //                     temp[i].setAttribute("opacity", 1);
        //                 else
        //                     temp[i].setAttribute("opacity", 0.5);
        //             }
        //         }

        //         function refreshUI(svg, opacity = "1", nowTable) {

        //             for (let i = 0; i < data.length; i++) { //全部的桌子

        //                 if (data[i].isAvailable) { //根據data的isAvailable 去變色
        //                     svg.contentDocument.querySelectorAll(`[class=seatF${i + 1}]`).forEach((seat) => { //找到對應的桌子 裡面有有兩張椅子 迴圈找裡面兩張椅子
        //                         if (seat.getAttribute("class") != nowTable) {
        //                             seat.setAttribute("fill", "#F0F0F0"); //初始化顏色
        //                             seat.setAttribute("opacity", opacity);  //初始化透明度
        //                             seat.setAttribute("isClicked", "0");
        //                         }
        //                         if (seat.getAttribute("isClicked") == 1) {
        //                             seat.setAttribute("fill", "#6DAA7C");//可以選的椅子點下去變綠色
        //                         }
        //                     });
        //                 }
        //                 else {
        //                     svg.contentDocument.querySelectorAll(`[class=seatF${i + 1}]`).forEach((seat) => {
        //                         seat.setAttribute("fill", "#8C8C8C");
        //                     });
        //                 }
        //             }
        //         }





        // ----- 車廂選項綁定車廂座位與車廂圖片 -----
        document.getElementById('car_type').addEventListener('change', function () {
            // var seatSelect = document.getElementById('seat');
            var carImage = document.getElementById('car_image');

            // 清空座位選項
            // seatSelect.innerHTML = '';

            if (this.value === 'e') {
                // seatSelect.innerHTML += '<option value="0">請選擇座位</option>';
                // seatSelect.innerHTML += '<option value="e1">E2</option>';
                // seatSelect.innerHTML += '<option value="e2">E3</option>';
                // seatSelect.innerHTML += '<option value="e3">E4</option>';
                carImage.data = '/src/assets/images/plan/E.svg';
            } else if (this.value === 'd') {
                // seatSelect.innerHTML += '<option value="0">請選擇座位</option>';
                // seatSelect.innerHTML += '<option value="d1">D1</option>';
                // seatSelect.innerHTML += '<option value="d2">D2</option>';
                // seatSelect.innerHTML += '<option value="d3">D3</option>';
                // seatSelect.innerHTML += '<option value="d4">D4</option>';
                // seatSelect.innerHTML += '<option value="d5">D5</option>';
                // seatSelect.innerHTML += '<option value="d6">D6</option>';
                carImage.data = '/src/assets/images/plan/D.svg';

            } else if (this.value === 'a') {
                // seatSelect.innerHTML += '<option value="0">請選擇座位</option>';
                // seatSelect.innerHTML += '<option value="a1">A1</option>';
                carImage.data = '/src/assets/images/plan/A.svg';

            }

            else if (this.value === 'f') {
                // 還原到原始選項
                // seatSelect.innerHTML += '<option value="0">請選擇座位</option>';
                // seatSelect.innerHTML += '<option value="f1">F1</option>';
                // seatSelect.innerHTML += '<option value="f2">F2</option>';
                // seatSelect.innerHTML += '<option value="f3">F3</option>';
                // seatSelect.innerHTML += '<option value="f4">F4</option>';
                // seatSelect.innerHTML += '<option value="f5">F5</option>';
                // seatSelect.innerHTML += '<option value="f6">F6</option>';
                // seatSelect.innerHTML += '<option value="f7">F7</option>';
                // seatSelect.innerHTML += '<option value="f8">F8</option>';
                carImage.data = '/src/assets/images/plan/F.svg';
            }
        });

        // -------------------------------------------
        // 甜點數量綁定人數
        document.addEventListener('DOMContentLoaded', function () {
            const dessertA = document.getElementById('dessert_jpA_qty');
            const dessertB = document.getElementById('dessert_jpB_qty');
            const people = document.getElementById('people');

            function updateDessertAOptions() {
                // 清空 dessertA 的選項
                dessertA.innerHTML = '';

                // 根據 people 的值添加選項到 dessertA
                const peopleCount = parseInt(people.value);

                for (let i = 0; i <= peopleCount; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    dessertA.appendChild(option);
                }

                // 更新 dessertB 的選項
                updateDessertBOptions();
            }

            function updateDessertBOptions() {
                const peopleCount = parseInt(people.value);
                const dessertAValue = parseInt(dessertA.value);

                // 計算 dessertB 的最大可選數量
                const maxDessertBValue = peopleCount - dessertAValue;

                // 清空 dessertB 的選項
                dessertB.innerHTML = '';

                // 根據計算出的最大值添加選項
                for (let i = 0; i <= maxDessertBValue; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    dessertB.appendChild(option);
                }
            }

            // 監聽 people 的選擇項改變事件
            people.addEventListener('change', updateDessertAOptions);

            // 監聽 dessertA 的選擇項改變事件
            dessertA.addEventListener('change', updateDessertBOptions);

            // 初始化選項
            updateDessertAOptions();
        });


        // ---------------------------------------------------
        // 訂位資料判斷
        function userInfoCheck(event) {

            // 取得輸入框
            const name = document.getElementById('Name');
            const phone = document.getElementById('phone');
            const email = document.getElementById('email');
            const creditCard = document.getElementById('creditCard');

            // 清除之前的錯誤信息
            document.querySelectorAll('.error').forEach(span => {
                // span.textContent = ''; // 清空文本
                span.classList.remove('active'); // 隱藏錯誤提示
            });

            let isValid = true;

            // 驗證姓名
            if (name.value.trim() === '' || name.value.length < 2) {
                const errorSpan = name.nextElementSibling;
                errorSpan.textContent = '請輸入有效姓名！';
                errorSpan.classList.add('active');
                isValid = false;
            }

            // 驗證手機號碼
            if (!phone.value.match(/^09[0-9]{8}$/)) {
                const errorSpan = phone.nextElementSibling;
                errorSpan.textContent = '請輸入有效的手機號碼！';
                errorSpan.classList.add('active');
                isValid = false;
            }

            // 驗證電子郵件
            if (!email.value.match(/^[^@\s]+@[^@\s]+\.[^@\s]+$/)) {
                const errorSpan = email.nextElementSibling;
                errorSpan.textContent = '請輸入有效的電子郵件！';
                errorSpan.classList.add('active');
                isValid = false;
            }

            // 驗證信用卡號
            if (!creditCard.value.match(/^[0-9]{4}-[0-9]{4}-[0-9]{4}-[0-9]{4}$/)) {
                const errorSpan = creditCard.nextElementSibling;
                errorSpan.textContent = '請輸入有效的信用卡號！';
                errorSpan.classList.add('active');
                isValid = false;
            }

            if (isValid) {
                console.log('輸入正確');
                // window.location.href = 'order.html';
            } else {
                console.log('輸入錯誤');

            }
        };
    </script>


</body>

</html>